---
// Componente de formulario usando solo clases de Tailwind, sin JS ni CSS adicional
---

<div class="max-w-xl bg-white">
  <div class="bg-brown-influvac text-white text-center px-6 py-6">
    <h1 class="text-xl font-semibold tracking-wide">PARÁMETROS DEL MODELO</h1>
  </div>

  <form class="px-8 py-4 space-y-4" id="modelParametersForm">
    <!-- Parámetros Básicos -->
    <div>
      <div class="flex flex-col gap-2">
        <label for="numEmpleados" class="text-sm font-semibold text-slate-700"
          >Número de Empleados
          <span class="text-red-500">*</span>
        </label>
        <input
          id="numEmpleados"
          name="numEmpleados"
          type="number"
          required
          value="5000"
          class="w-full rounded-lg border-2 border-slate-200 bg-slate-50 px-4 py-3 text-sm focus:border-blue-influvac focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-influvac/40"
        />
      </div>
    </div>

    <div class="grid gap-6 md:grid-cols-2">
      <div class="space-y-4">
        <div class="flex flex-col gap-2">
          <label
            for="fecha1Vacunacion"
            class="text-sm font-semibold text-slate-700"
            >Fecha 1 de Vacunación <span class="text-red-500">*</span></label
          >
          <input
            id="fecha1Vacunacion"
            name="fecha1Vacunacion"
            type="date"
            required
            value="2025-05-30"
            class="w-full rounded-lg border-2 border-slate-200 bg-slate-50 px-4 py-3 text-sm focus:border-blue-influvac focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-influvac/40"
          />
        </div>
        <div class="flex flex-col gap-2">
          <label
            for="numeroDeVacunados1"
            class="text-sm font-semibold text-slate-700"
            >Número de Vacunados 1 <span class="text-red-500">*</span></label
          >
          <input
            id="numeroDeVacunados1"
            name="numeroDeVacunados1"
            type="number"
            required
            value="2000"
            class="w-full rounded-lg border-2 border-slate-200 bg-slate-50 px-4 py-3 text-sm focus:border-blue-influvac focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-influvac/40"
          />
        </div>
      </div>
      <div class="space-y-4">
        <div class="flex flex-col gap-2">
          <label
            for="fecha2Vacunacion"
            class="text-sm font-semibold text-slate-700"
            >Fecha 2 de Vacunación</label
          >
          <input
            id="fecha2Vacunacion"
            name="fecha2Vacunacion"
            type="date"
            class="w-full rounded-lg border-2 border-slate-200 bg-slate-50 px-4 py-3 text-sm focus:border-blue-influvac focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-influvac/40"
          />
        </div>
        <div class="flex flex-col gap-2">
          <label
            for="numeroDeVacunados2"
            class="text-sm font-semibold text-slate-700"
            >Número de Vacunados 2</label
          >
          <input
            id="numeroDeVacunados2"
            name="numeroDeVacunados2"
            type="number"
            value="0"
            class="w-full rounded-lg border-2 border-slate-200 bg-slate-50 px-4 py-3 text-sm focus:border-blue-influvac focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-influvac/40"
          />
        </div>
      </div>
    </div>

    <!-- Parámetros Financieros -->
    <div>
      <div
        class="bg-blue-influvac text-white font-semibold text-sm tracking-wide px-6 py-3 -mx-8 mb-3 mt-4"
      >
        PARÁMETROS FINANCIEROS
      </div>

      <div class="flex flex-col gap-2 mb-6">
        <label
          for="calculoProductividad"
          class="text-sm font-semibold text-slate-700"
          >Cálculo de Productividad/Persona</label
        >
        <select
          id="calculoProductividad"
          name="calculoProductividad"
          required
          class="w-full rounded-lg border-2 border-slate-200 bg-slate-50 px-4 py-3 text-sm focus:border-blue-influvac focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-influvac/40"
        >
          <option value="promedio_empresarial">Promedio empresarial</option>
          <option value="productividad_individual"
            >Productividad Individual</option
          >
        </select>
      </div>

      <div class="grid gap-6 md:grid-cols-2 mb-6">
        <div class="flex flex-col gap-2">
          <label
            for="ventaNeta2022"
            class="text-sm font-semibold text-slate-700"
            >Venta Neta (ultimo año)</label
          >
          <div
            class="flex rounded-lg border-2 border-slate-200 bg-slate-50 focus-within:border-blue-influvac focus-within:bg-white focus-within:ring-2 focus-within:ring-blue-influvac/40"
          >
            <span
              class="px-3 flex items-center text-slate-500 font-semibold text-sm"
              >$</span
            >
            <input
              id="ventaNeta"
              name="ventaNeta"
              type="text"
              inputmode="decimal"
              data-thousands
              data-decimals="0"
              required
              value="4388774488000"
              class="w-full bg-transparent px-2 py-3 text-sm focus:outline-none"
            />
          </div>
        </div>
        <div class="flex flex-col gap-2">
          <label
            for="indicadorProductividad"
            class="text-sm font-semibold text-slate-700"
            >Indicador de Productividad por Empleado</label
          >
          <div
            class="flex rounded-lg border-2 border-slate-200 bg-slate-50 focus-within:border-blue-influvac focus-within:bg-white focus-within:ring-2 focus-within:ring-blue-influvac/40"
          >
            <span
              class="px-3 flex items-center text-slate-500 font-semibold text-sm"
              >$</span
            >
            <input
              id="indicadorProductividad"
              name="indicadorProductividad"
              type="text"
              inputmode="decimal"
              data-thousands
              data-decimals="2"
              required
              value="73146241.47"
              class="w-full bg-transparent px-2 py-3 text-sm focus:outline-none"
            />
          </div>
        </div>
      </div>

      <div class="grid gap-6 md:grid-cols-2">
        <div class="flex flex-col gap-2">
          <label
            for="salarioPromedio"
            class="text-sm font-semibold text-slate-700"
            >Salario Promedio de los Colaboradores</label
          >
          <div
            class="flex rounded-lg border-2 border-slate-200 bg-slate-50 focus-within:border-blue-influvac focus-within:bg-white focus-within:ring-2 focus-within:ring-blue-influvac/40"
          >
            <span
              class="px-3 flex items-center text-slate-500 font-semibold text-sm"
              >$</span
            >
            <input
              id="salarioPromedio"
              name="salarioPromedio"
              type="text"
              inputmode="decimal"
              data-thousands
              data-decimals="0"
              required
              value="6000000"
              class="w-full bg-transparent px-2 py-3 text-sm focus:outline-none"
            />
          </div>
        </div>
        <div class="flex flex-col gap-2">
          <label
            for="precioVacunacion"
            class="text-sm font-semibold text-slate-700"
            >Precio Vacunación Influenza</label
          >
          <div
            class="flex rounded-lg border-2 border-slate-200 bg-slate-50 focus-within:border-blue-influvac focus-within:bg-white focus-within:ring-2 focus-within:ring-blue-influvac/40"
          >
            <span
              class="px-3 flex items-center text-slate-500 font-semibold text-sm"
              >$</span
            >
            <input
              id="precioVacunacion"
              name="precioVacunacion"
              type="text"
              inputmode="decimal"
              data-thousands
              data-decimals="0"
              required
              value="55000"
              class="w-full bg-transparent px-2 py-3 text-sm focus:outline-none"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- Parámetros Operacionales -->
    <div>
      <div
        class="bg-blue-influvac text-white font-semibold text-sm tracking-wide px-6 py-3 -mx-8 mb-6"
      >
        PARÁMETROS OPERACIONALES
      </div>

      <div class="grid gap-6 md:grid-cols-2">
        <div class="flex flex-col gap-2">
          <label
            for="nivelExposicion"
            class="text-sm font-semibold text-slate-700"
            >Nivel de Exposición al Público</label
          >
          <select
            id="nivelExposicion"
            name="nivelExposicion"
            required
            class="w-full rounded-lg border-2 border-slate-200 bg-slate-50 px-4 py-3 text-sm focus:border-blue-influvac focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-influvac/40"
          >
            <option value="1">Bajo</option>
            <option value="2" selected>Medio</option>
            <option value="3">Alto</option>
          </select>
        </div>
        <div class="flex flex-col gap-2">
          <label
            for="diasIncapacidad"
            class="text-sm font-semibold text-slate-700"
            >Días de Incapacidad Promedio</label
          >
          <input
            id="diasIncapacidad"
            name="diasIncapacidad"
            type="number"
            required
            min="1"
            max="30"
            value="5"
            class="w-full rounded-lg border-2 border-slate-200 bg-slate-50 px-4 py-3 text-sm focus:border-blue-influvac focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-influvac/40"
          />
        </div>
      </div>
    </div>

    <!-- Botones -->
    <div
      class="flex flex-col sm:flex-row gap-4 justify-center pt-6 border-t border-slate-200"
    >
      <button
        type="submit"
        class="inline-flex justify-center rounded-lg bg-brown-influvac px-8 py-3 text-sm font-semibold tracking-wide text-white shadow-md transition hover:shadow-lg hover:shadow-brown-influvac focus:outline-none focus:ring-4 focus:ring-brown-influvac/40"
      >
        Calcular Modelo
      </button>
      <button
        type="reset"
        class="inline-flex justify-center rounded-lg bg-slate-600 px-8 py-3 text-sm font-semibold tracking-wide text-white shadow-md transition hover:bg-slate-700 focus:outline-none focus:ring-4 focus:ring-slate-300"
      >
        Limpiar Formulario
      </button>
    </div>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const locale = "es-CO";
    const form = document.getElementById("modelParametersForm");
    if (!form) return;
    const inputs = form.querySelectorAll("input[data-thousands]");

    function toNumberString(str: string, decimals: number) {
      if (!str) return "";
      // Eliminar cualquier caracter excepto dígitos, coma y punto
      let cleaned = str.replace(/[^0-9,\.]/g, "");
      // Detectar el separador decimal: si hay ambos, el último símbolo entre coma/punto será decimal
      const lastComma = cleaned.lastIndexOf(",");
      const lastDot = cleaned.lastIndexOf(".");
      let decimalIndex = Math.max(lastComma, lastDot);
      let intPart,
        decPart = "";
      if (decimalIndex > -1) {
        intPart = cleaned.slice(0, decimalIndex).replace(/[^0-9]/g, "");
        decPart = cleaned.slice(decimalIndex + 1).replace(/[^0-9]/g, "");
      } else {
        intPart = cleaned.replace(/[^0-9]/g, "");
      }
      if (decimals === 0) return intPart;
      if (decPart.length > decimals) decPart = decPart.slice(0, decimals);
      return decPart ? intPart + "." + decPart : intPart;
    }

    function formatVisible(numberString: string, decimals: number) {
      if (!numberString) return "";
      const num = Number(numberString);
      if (isNaN(num)) return "";
      return new Intl.NumberFormat(locale, {
        minimumFractionDigits: decimals,
        maximumFractionDigits: decimals,
      }).format(num);
    }

    inputs.forEach((inp) => {
      const input = inp as HTMLInputElement;
      const decimals = parseInt(input.dataset.decimals || "0", 10);
      function reformat() {
        const numStr = toNumberString(input.value, decimals);
        if (numStr === "") {
          input.dataset.rawNumber = "";
          input.value = "";
          return;
        }
        input.dataset.rawNumber = numStr; // Guardar valor limpio
        const selectionEnd = input.selectionEnd;
        input.value = formatVisible(numStr, decimals);
        // Intentar mantener el cursor al final (simplificado)
        input.setSelectionRange(input.value.length, input.value.length);
      }
      input.addEventListener("input", reformat);
      input.addEventListener("blur", reformat);
      // Formatear inicial
      reformat();
    });

    // Antes de enviar, reemplazar el valor visible por el valor numérico crudo (sin separadores)
    form.addEventListener("submit", () => {
      inputs.forEach((inp) => {
        const input = inp as HTMLInputElement;
        const decimals = parseInt(input.dataset.decimals || "0", 10);
        const raw =
          input.dataset.rawNumber || toNumberString(input.value, decimals);
        input.value = raw; // backend / cálculo recibe valor estándar con punto decimal
      });
    });
  });
</script>
